<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <title>Video Conference</title>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/responsive.css" />
    <!--
      <script src="https://rtcmulticonnection.herokuapp.com/dist/RTCMultiConnection.min.js"></script>
      <script src="https://rtcmulticonnection.herokuapp.com/socket.io/socket.io.js"></script>
    -->
    <script src="js/jquery.min.js"></script>
    <script src="js/RTCMultiConnection.min.js"></script>
    <script src="js/socket.io.js"></script>
  </head>

  <body>
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <div id="other-videos-holder"></div>
          <div id="local-video-holder"></div>
        </div>
      </div>
    </div>
  </body>
  <script>
    var connection = new RTCMultiConnection();

    // this line is VERY_important
    connection.socketURL = "https://rtcmulticonnection.herokuapp.com:443/";

    // all below lines are optional; however recommended.

    connection.session = {
      audio: true,
      video: true
    };

    connection.sdpConstraints.mandatory = {
      OfferToReceiveAudio: true,
      OfferToReceiveVideo: true
    };

    var other_videos_holder = document.getElementById("other-videos-holder");
    var local_video_holder = document.getElementById("local-video-holder");
    connection.onstream = function(event) {
      //document.body.appendChild( event.mediaElement );
      if (event.type === "local") {
        local_video_holder.appendChild(event.mediaElement);
      } else {
        other_videos_holder.appendChild(event.mediaElement);
      }
      document.querySelectorAll("video").forEach(el => {
        el.removeAttribute("controls");
      });
      var numOfVideo = $("#other-videos-holder")[0].children.length;
      var video = $("#other-videos-holder video");
      var otherVideo = $("#other-videos-holder");
      switch (numOfVideo) {
        case 1:
          video.addClass("one");
          video.removeClass("two three four");
          break;
        case 2:
          video.addClass("two");
          video.removeClass("one three four");
          break;
        case 3:
          video.addClass("three");
          video.removeClass("one two four");
          break;
        case 4:
          video.addClass("four");
          video.removeClass("one two three");
          break;
        case 5:
          video.addClass("five");
          break;
      }
    };

    var predefinedRoomId = getQueryStringValue("tocken");

    function getQueryStringValue(key) {
      return decodeURIComponent(
        window.location.search.replace(
          new RegExp(
            "^(?:.*[&\\?]" +
              encodeURIComponent(key).replace(/[\.\+\*]/g, "\\$&") +
              "(?:\\=([^&]*))?)?.*$",
            "i"
          ),
          "$1"
        )
      );
    }

    window.onload = function() {
      connection.openOrJoin(predefinedRoomId);
    };

    (function() {
      $(window).load(function () {
          if($(window).width() < 992) {
              $(".container").addClass("container-fluid").removeClass("container");
          }
      })
    })();
  </script>
  <script src="js/main.js"></script>
</html>
